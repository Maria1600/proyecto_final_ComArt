<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Perfil</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/perfilStyle.css') }}">
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
    <div class="logo" onclick="location.href='{{ url_for('inicio') }}'">
        <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo">
        <span class="nombre-app">ComArt</span>
    </div>
    <div class="search-container">
        <input type="text" placeholder="Buscar...">
    </div>
    <div class="icono-usuario" onclick="toggleDropdown()">
        <img src="{{ url_for('static', filename='img/user_icon.png') }}" alt="Usuario">
        <div id="dropdown" class="dropdown-menu hidden">
            <a href="{{ url_for('perfil') }}">Ver perfil</a>
            <a href="{{ url_for('login') }}"><i class="fa fa-sign-out-alt"></i> Cerrar sesi√≥n</a>
        </div>
    </div>
</nav>

<div class="perfil-encabezado">
    <div class="avatar-contenedor">
        <span class="icono-usuario">üë§</span>
    </div>
    <div class="perfil-info">
        <h2>{{ usuario.nombre }}</h2>
        <p class="fecha-creacion">{{ usuario.fecha_creacion }}</p>
        <div class="seguimiento">
            <div>Seguidores<br><strong>{{ usuario.seguidores }}</strong></div>
            <div>Seguidos<br><strong>{{ usuario.seguidos }}</strong></div>
            {% if es_logado %}
            <!-- No se muestra bot√≥n de seguir -->
            {% else %}
            <form method="POST" action="/seguir">
                <input type="hidden" name="usuario_id" value="{{ usuario.id }}">
                <button class="boton-seguir" type="submit">seguir</button>
            </form>
            {% endif %}
        </div>
    </div>
</div>

<div class="descripcion-caja">
    {% if es_logado %}
    {% if modo_edicion %}
    <form method="POST" action="/guardar-descripcion">
        <textarea name="nueva_descripcion">{{ usuario.descripcion }}</textarea>
        <div class="botones-edicion">
            <button type="submit" class="btn-guardar">‚úî</button>
            <a href="/perfil" class="btn-cancelar">‚úñ</a>
        </div>
    </form>
    {% else %}
    <p>{{ usuario.descripcion }}</p>
    <form method="GET" action="/perfil?editar=1">
        <button class="btn-editar">‚úé</button>
    </form>
    {% endif %}
    {% else %}
    <p>{{ usuario.descripcion }}</p>
    {% endif %}
</div><!-- PERFIL GENERAL HTML -->
<div class="perfil-encabezado">
    <div class="avatar-contenedor">
        <span class="icono-usuario">üë§</span>
    </div>
    <div class="perfil-info">
        <h2>{{ usuario.nombre }}</h2>
        <p class="fecha-creacion">{{ usuario.fecha_creacion }}</p>
        <div class="seguimiento">
            <div>Seguidores<br><strong>{{ usuario.seguidores }}</strong></div>
            <div>Seguidos<br><strong>{{ usuario.seguidos }}</strong></div>

            {% if not es_logado %}
            <form method="POST" action="/seguir">
                <input type="hidden" name="usuario_id" value="{{ usuario.id }}">
                <button class="boton-seguir">seguir</button>
            </form>
            {% endif %}
        </div>
    </div>
</div>

<!-- USUARIO NORMAL -->
{% if not usuario.es_artista %}
<div class="perfil-descripcion">
    {% if es_logado and modo_edicion %}
    <form method="POST" action="/guardar-descripcion">
        <textarea name="nueva_descripcion">{{ usuario.descripcion }}</textarea>
        <div class="botones-edicion">
            <button type="submit" class="btn-guardar">‚úî</button>
            <a href="/perfil" class="btn-cancelar">‚úñ</a>
        </div>
    </form>
    {% else %}
    <p>{{ usuario.descripcion }}</p>
    {% if es_logado %}
    <form method="GET" action="/perfil?editar=1">
        <button class="btn-editar">‚úé</button>
    </form>
    {% endif %}
    {% endif %}
</div>

<!-- USUARIO ARTISTA -->
{% else %}
<div class="perfil-artista-contenido">
    <div class="info-artista">
        <div class="descripcion-caja">
            {% if es_logado and modo_edicion %}
            <form method="POST" action="/guardar-descripcion">
                <textarea name="nueva_descripcion">{{ usuario.descripcion }}</textarea>
                <div class="botones-edicion">
                    <button type="submit" class="btn-guardar">‚úî</button>
                    <a href="/perfil" class="btn-cancelar">‚úñ</a>
                </div>
            </form>
            {% else %}
            <p>{{ usuario.descripcion }}</p>
            {% if es_logado %}
            <form method="GET" action="/perfil?editar=1">
                <button class="btn-editar">‚úé</button>
            </form>
            {% endif %}
            {% endif %}
        </div>

        <div class="tags-artista">
            {% for tag in usuario.tags %}
            <span class="tag">{{ tag }}</span>
            {% endfor %}
            {% if es_logado %}
            <form method="GET" action="/editar_tags">
                <button class="btn-editar">‚úé</button>
            </form>
            {% endif %}
        </div>
    </div>

    <div class="publicaciones-artista">
        <div class="publicaciones-header">
            <h3>PUBLICACIONES</h3>
            {% if es_logado %}
            <a href="/crear_publicacion" class="boton-gradiente">+ Crear publicaci√≥n</a>
            {% else %}
            <a href="/abrir_comision/{{ usuario.id }}" class="boton-gradiente">+ Abrir comisi√≥n</a>
            {% endif %}
        </div>

        <div class="lista-publicaciones">
            {% for pub in publicaciones %}
            <div class="publicacion">
                <div class="publicacion-cabecera">
                    <span class="nombre-autor">{{ usuario.nombre }}</span>
                    <span class="fecha-publicacion">{{ pub.fecha }}</span>
                </div>
                <img src="{{ pub.imagen_url }}" alt="imagen publicaci√≥n" class="imagen-publicacion">
                <div class="texto-publicacion">
                    <p>{{ pub.descripcion }}</p>
                </div>
                <div class="acciones-publicacion">
                    <span>üëç {{ pub.likes }}</span>
                    {% if es_logado %}
                    <form method="GET" action="/editar_publicacion/{{ pub.id }}">
                        <button class="btn-editar">‚úé</button>
                    </form>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- Footer -->
<footer class="footer">
    <button onclick="location.href='{{ url_for('inicio') }}'" class="boton-footer">Inicio</button>
    <button onclick="location.href='{{ url_for('comisiones') }}'" class="boton-footer">Comisiones</button>
    <button onclick="location.href='{{ url_for('notificaciones') }}'" class="boton-footer">Notificaciones</button>
    <button onclick="location.href='{{ url_for('perfil') }}'" class="boton-footer activo">Perfil</button>
</footer>

</body>
</html>
