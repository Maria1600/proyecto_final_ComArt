<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Inicio</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/inicioStyle.css') }}">
    <!-- Iconos de Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<!-- Navbar -->
<nav class="nav">
    <div class="logo" onclick="location.href='{{ url_for('inicio') }}'">
        <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo">
        <span class="titulo-app">ComArt</span>
    </div>

    <div class="search-container">
        <input type="text" placeholder="Búsqueda">
    </div>

    <div class="perfil-icono" onclick="toggleDropdown()">
        <i class="fa-solid fa-user avatar icono-perfil"></i>
        <div id="dropdown" class="dropdown-menu hidden">
            <a href="{{ url_for('perfil') }}">Ver perfil</a>
            <a href="{{ url_for('login') }}"><i class="fa fa-sign-out-alt"></i> Cerrar sesión</a>
        </div>
    </div>
</nav>

<div class="crear-comision-container">
    <button class="crear-comision-btn" onclick="location.href='{{ url_for('crear_comision') }}'">+ Crear comisión global</button>
</div>

<div class="muro">
    <!-- Aqui se irán generando automaticamente los apartados gracias al script -->
</div>

<!-- Footer -->
<footer class="footer">
    <button onclick="location.href='{{ url_for('inicio') }}'" class="boton-footer">Inicio</button>
    <button onclick="location.href='{{ url_for('comisiones') }}'" class="boton-footer">Comisiones</button>
    <button onclick="location.href='{{ url_for('notificaciones') }}'" class="boton-footer activo">Notificaciones</button>
    <button onclick="location.href='{{ url_for('perfil') }}'" class="boton-footer">Perfil</button>
</footer>

</body>

<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const contenedor = document.getElementById("muro-contenido");

        // Fetch de publicaciones y comisiones para que vayan generandose aleatoriamente
        const [pubsRes, comsRes] = await Promise.all([
            fetch("/publicaciones"),
            fetch("/comisiones/globales")
        ]);

        const publicaciones = await pubsRes.json();
        const comisiones = await comsRes.json();

        // Añadimos un tipo a cada elemento para diferenciarlos
        const datos = [
            ...publicaciones.map(p => ({ tipo: "publicacion", ...p })),
            ...comisiones.map(c => ({ tipo: "comision", ...c }))
        ];

        // Mezclar aleatoriamente
        datos.sort(() => Math.random() - 0.5);

        // Renderizado
        for (const item of datos) {
            const div = document.createElement("div");

            if (item.tipo === "publicacion") {
                div.classList.add("publicacion");
                div.innerHTML = `
                    <div class="info-usuario">
                        <i class="fa-solid fa-user avatar icono-perfil" onclick="location.href='/perfil'"></i>
                        <div>
                            <div onclick="location.href='/perfil'"><strong>${item.artista}</strong></div>
                            <div>${item.fecha_publicacion}</div>
                        </div>
                    </div>
                    <div class="contenido-publicacion">
                        <img src="/static/${item.dibujo}" alt="Imagen subida">
                        <div class="descripcion">${item.descripcion_publicacion}</div>
                    </div>
                    <div class="likes">
                        <button class="like-btn">
                            <i class="fa fa-thumbs-up"></i>
                        </button>
                        <span>${item.num_likes}</span>
                    </div>
                `;
            } else if (item.tipo === "comision") {
                div.classList.add("comision-global");
                div.innerHTML = `
                    <div class="info-usuario">
                        <i class="fa-solid fa-user avatar icono-perfil" onclick="location.href='/perfil'"></i>
                        <div>
                            <div onclick="location.href='/perfil'"><strong>${item.cliente}</strong></div>
                            <div>${item.fecha_creacion}</div>
                        </div>
                    </div>
                    <div class="etiqueta">Comisión global</div>
                    <div class="descripcion">${item.descripcion_com}</div>
                    <button class="boton-comision">Apuntarse</button>
                `;
            }

            contenedor.appendChild(div);
        }
    });
</script>

</html>
